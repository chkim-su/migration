{
  "description": "Strict migration enforcement hooks v2.1 - BLOCKS if enforcement system not installed",
  "hooks": {
    "PreToolUse": [
      {
        "matcher": {
          "tool_name": "Bash",
          "input_contains": ["mkdir -p .migration", "cat > .migration", "echo > .migration"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "echo '❌ BLOCKED: Creating manual workarounds is not allowed.' && echo '' && echo 'You are trying to create .migration/ manually instead of using the enforcement system.' && echo '' && echo 'REQUIRED: Run bootstrap first:' && echo '  export STRICT_MIGRATION_PLUGIN_DIR=\"/path/to/strict-migration-plugin\"' && echo '  bash \"$STRICT_MIGRATION_PLUGIN_DIR/scripts/bootstrap.sh\" .' && echo '' && exit 1",
            "timeout": 5000,
            "onError": "❌ BLOCKED: Manual .migration/ workarounds not allowed. Run bootstrap.sh instead."
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Bash",
          "input_contains": ["npm test", "pytest", "mvn test", "yarn test", "pnpm test", "cargo test", "go test"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] || (echo '❌ BLOCKED: Enforcement system not installed.' && echo 'Run bootstrap.sh first, then /migrate.' && exit 1) && bash scripts/enforce-workflow.sh require-workflow 'test execution' && bash scripts/enforce-workflow.sh require-gate final_audit_passed 'test execution'",
            "timeout": 30000,
            "onError": "❌ BLOCKED: Either enforcement system not installed, workflow not initialized, or final audit not passed."
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["simulation-test-runner"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] || (echo '❌ BLOCKED: Enforcement system not installed.' && echo 'You MUST install scripts/ before running agents.' && echo '' && echo 'Run:' && echo '  export STRICT_MIGRATION_PLUGIN_DIR=\"...\"' && echo '  bash \"$STRICT_MIGRATION_PLUGIN_DIR/scripts/bootstrap.sh\" .' && exit 1) && bash scripts/enforce-workflow.sh require-workflow 'Phase 2 simulation tests' && bash scripts/enforce-workflow.sh require-gate static_tests_passed 'Phase 2 simulation tests'",
            "timeout": 10000,
            "onError": "❌ BLOCKED: Phase 2 requires: (1) enforcement system installed, (2) workflow initialized, (3) Phase 1 passed."
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["static-test-runner", "test-orchestrator"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] || (echo '❌ BLOCKED: Enforcement system not installed.' && echo 'Install scripts/ before running test agents.' && exit 1) && bash scripts/enforce-workflow.sh require-workflow 'test runner' && bash scripts/enforce-workflow.sh require-gate final_audit_passed 'test execution'",
            "timeout": 10000,
            "onError": "❌ BLOCKED: Test runner requires: (1) enforcement system, (2) workflow initialized, (3) final audit passed."
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["implementation-auditor"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] || (echo '❌ BLOCKED: Enforcement system not installed.' && exit 1) && bash scripts/enforce-workflow.sh require-workflow 'implementation audit'",
            "timeout": 10000,
            "onError": "❌ BLOCKED: Audit requires enforcement system installed and workflow active."
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["solid-analyzer"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] || (echo '❌ BLOCKED: Enforcement system not installed.' && exit 1) && bash scripts/enforce-workflow.sh require-workflow 'SOLID analysis' && bash scripts/enforce-workflow.sh require-gate scope_confirmed 'SOLID analysis'",
            "timeout": 10000,
            "onError": "❌ BLOCKED: SOLID analysis requires enforcement system and confirmed scope."
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["migration-planner"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] || (echo '❌ BLOCKED: Enforcement system not installed.' && exit 1) && bash scripts/enforce-workflow.sh require-workflow 'migration planning'",
            "timeout": 10000,
            "onError": "❌ BLOCKED: Migration planning requires enforcement system installed."
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Write",
          "input_contains": ["/src/", "/lib/", "/app/", ".py", ".ts", ".js", ".java", ".go", ".rs"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/enforce-workflow.sh is-initialized >/dev/null 2>&1 || echo 'INFO: Writing code without strict-migration tracking.'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Edit",
          "input_contains": ["/src/", "/lib/", "/app/", ".py", ".ts", ".js", ".java", ".go", ".rs"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/enforce-workflow.sh is-initialized >/dev/null 2>&1 || echo 'INFO: Editing code without strict-migration tracking.'",
            "timeout": 5000
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["implementation-auditor"],
          "output_contains": ["FINAL VERDICT: PASS", "VERDICT: PASS"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/state-machine.sh pass-gate final_audit_passed && bash scripts/state-machine.sh complete-phase final_audit && echo '✓ Final audit PASSED - Testing now allowed'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["implementation-auditor"],
          "output_contains": ["FINAL VERDICT: FAIL", "VERDICT: FAIL"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/state-machine.sh set 'gates_passed.final_audit_passed' 'false'; echo '❌ AUDIT FAILED - Testing BLOCKED until audit passes.'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["static-test-runner"],
          "output_contains": ["PASS", "Phase 1 Verdict: PASS", "all tests passed"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/state-machine.sh pass-gate static_tests_passed && bash scripts/state-machine.sh complete-phase phase1_testing && bash scripts/enforce-workflow.sh record-evidence static PASS 'Static tests completed' && echo '' && echo '════════════════════════════════════════════════════════════' && echo '  ✓ Phase 1 PASSED' && echo '' && echo '  ⚠️  MANDATORY: Run Phase 2 simulation tests now!' && echo '' && echo '  → Launch: simulation-test-runner' && echo '════════════════════════════════════════════════════════════'",
            "timeout": 10000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["static-test-runner"],
          "output_contains": ["FAIL", "Phase 1 Verdict: FAIL", "tests failed"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/state-machine.sh set 'gates_passed.static_tests_passed' 'false'; echo '❌ Phase 1 FAILED - Phase 2 is BLOCKED.'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["simulation-test-runner"],
          "output_contains": ["PASS", "Phase 2 Verdict: PASS", "simulation passed"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/state-machine.sh pass-gate simulation_tests_passed && bash scripts/state-machine.sh complete-phase phase2_testing && bash scripts/enforce-workflow.sh record-evidence simulation PASS 'Real simulation tests completed' && echo '' && echo '════════════════════════════════════════════════════════════' && echo '  ✓ Phase 2 SIMULATION TESTS PASSED' && echo '' && echo '  All gates cleared. Ready for completion.' && echo '════════════════════════════════════════════════════════════'",
            "timeout": 10000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["simulation-test-runner"],
          "output_contains": ["FAIL", "Phase 2 Verdict: FAIL", "simulation failed"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/state-machine.sh set 'gates_passed.simulation_tests_passed' 'false'; echo '❌ Phase 2 SIMULATION FAILED - Completion BLOCKED.'",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["solid-analyzer"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/state-machine.sh complete-phase solid_analysis || true",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": {
          "tool_name": "Task",
          "input_contains": ["migration-planner"]
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/state-machine.sh complete-phase migration_planning || true",
            "timeout": 5000
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/enforce-workflow.sh verify-completion 2>/dev/null || (echo '' && echo '═══════════════════════════════════════════════════════════' && echo '  ⚠️  COMPLETION CHECK' && echo '═══════════════════════════════════════════════════════════' && echo '' && echo '  If you were running strict-migration:' && echo '  - Ensure Phase 2 simulation tests were run' && echo '  - Ensure all gates are passed' && echo '' && echo '═══════════════════════════════════════════════════════════' && exit 0)",
            "timeout": 30000
          }
        ]
      }
    ],
    "Notification": [
      {
        "matcher": {
          "type": "progress"
        },
        "hooks": [
          {
            "type": "command",
            "command": "[ -f scripts/state-machine.sh ] && bash scripts/progress-tracker.sh compact 2>/dev/null || true",
            "timeout": 5000
          }
        ]
      }
    ]
  }
}
